DELIMITER $

CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_content`(
        IN `p_userid` INT,
        IN `p_contentid` INT,
        IN `p_content` VARCHAR(100),
        IN `p_sectionholdingid` TINYINT,
        IN `p_projectid` INT,
        IN `p_mode` TINYINT,
        INOUT `o_outparameter` INT
)
BEGIN
-- mode 1 insert the new record of content
        IF(p_mode = 1) THEN
		-- inserting the content record in the tbl_content
                INSERT INTO tbl_content(content, content_added_date, section_holding_ids, project_id, user_id) VALUES (p_content,CURRENT_TIMESTAMP(),p_sectionholdingid,p_projectid,p_userid);

		-- setting the last insert id to out parameter
                SET o_outparameter = LAST_INSERT_ID();

        	-- update the count of do it by 1
                UPDATE tbl_count SET count_doit = count_doit + 1 WHERE project_id = p_projectid;
        END if;

-- mode 2 if content is moved
        IF(p_mode =2) THEN
		-- getting previous section id of that content
                SET @previous_section_holding_div = (SELECT section_holding_ids FROM tbl_content WHERE content_id = p_contentid AND project_id = p_projectid);

		-- setting last update id equal to 0
                SET @LastUpdateID = 0;

		-- updating the content id
                UPDATE tbl_content SET section_holding_ids=p_sectionholdingid,content_id = (SELECT @LastUpdateID := content_id) WHERE content_id=p_contentid AND project_id=p_projectid;

		-- setting last update id
                SET o_outparameter = @LastUpdateID;

		-- if previous section id is 1 and new section id is 2 means this content is moved from do it section to in progress section
		IF(@previous_section_holding_div = 1 AND p_sectionholdingid = 2) THEN
                                UPDATE tbl_count SET count_doit = count_doit -1 , count_inprogress = count_inprogress +1 WHERE project_id = p_projectid;

		-- if previous section id is 1 and new section id is 3 means this content is moved from do it section to verify section
		ELSEIF(@previous_section_holding_div = 1 AND p_sectionholdingid = 3) THEN
                                UPDATE tbl_count SET count_doit = count_doit -1 , count_verify = count_verify +1 WHERE project_id = p_projectid;

		-- if previous section id is 1 and new section id is 4 means this content is moved from do it section to done section
		ELSEIF(@previous_section_holding_div = 1 AND p_sectionholdingid = 4) THEN
                                UPDATE tbl_count SET count_doit = count_doit -1 , count_done = count_done +1 WHERE project_id = p_projectid;

		-- if previous section id is 2 and new section id is 1 means this content is moved from in progress section to do it section
		ELSEIF(@previous_section_holding_div = 2 AND p_sectionholdingid = 1) THEN
                                UPDATE tbl_count SET count_inprogress = count_inprogress -1, count_doit = count_doit +1 WHERE project_id = p_projectid;

		-- if previous section id is 2 and new section id is 3 means this content is moved from in progress section to verify section
		ELSEIF(@previous_section_holding_div = 2 AND p_sectionholdingid = 3) THEN
                                UPDATE tbl_count SET count_inprogress = count_inprogress -1, count_verify = count_verify +1 WHERE project_id = p_projectid;

		-- if previous section id is 2 and new section id is 4 means this content is moved from in progress section to done section
		ELSEIF(@previous_section_holding_div = 2 AND p_sectionholdingid = 4) THEN
                                UPDATE tbl_count SET count_inprogress = count_inprogress -1, count_done = count_done +1 WHERE project_id = p_projectid;

		-- if previous section id is 3 and new section id is 1 means this content is moved from verify section to do it section
		ELSEIF(@previous_section_holding_div = 3 AND p_sectionholdingid = 1) THEN
                                UPDATE tbl_count SET count_verify = count_verify -1, count_doit = count_doit +1 WHERE project_id = p_projectid;

		-- if previous section id is 3 and new section id is 2 means this content is moved from verify section to in progress section
		ELSEIF(@previous_section_holding_div = 3 AND p_sectionholdingid = 2) THEN
                                UPDATE tbl_count SET count_verify = count_verify -1, count_inprogress = count_inprogress +1 WHERE project_id = p_projectid;

		-- if previous section id is 3 and new section id is 4 means this content is moved from verify section to done section
		ELSEIF(@previous_section_holding_div = 3 AND p_sectionholdingid = 4) THEN
                                UPDATE tbl_count SET count_verify = count_verify -1, count_done = count_done +1 WHERE project_id = p_projectid;

		-- if previous section id is 4 and new section id is 1 means this content is moved from done section to do it section
		ELSEIF(@previous_section_holding_div = 4 AND p_sectionholdingid = 1) THEN
                                UPDATE tbl_count SET count_done = count_done -1, count_doit = count_doit +1 WHERE project_id = p_projectid;

		-- if previous section id is 4 and new section id is 2 means this content is moved from done section to in progress section
		ELSEIF(@previous_section_holding_div = 4 AND p_sectionholdingid = 2) THEN
                                UPDATE tbl_count SET count_done = count_done -1, count_inprogress = count_inprogress +1 WHERE project_id = p_projectid;

		-- if previous section id is 4 and new section id is 3 means this content is moved from done section to verify section
		ELSEIF(@previous_section_holding_div = 4 AND p_sectionholdingid = 3) THEN
                                UPDATE tbl_count SET count_done = count_done -1, count_verify = count_verify +1 WHERE project_id = p_projectid;
                END if;
        END if;

-- mode 3 if content is modified
        IF(p_mode = 3) THEN
		-- updating the content text
		UPDATE tbl_content SET content = p_content WHERE content_id = p_contentid;

		-- setting the content id to out parameter
                SET o_outparameter =  p_contentid;
        END if;

-- mode 4 if content is deleted
	IF(p_mode = 4) THEN
		-- deleting the content 
		DELETE FROM tbl_content WHERE content_id = p_contentid;

		-- setting the content id to out parameter
		SET o_outparameter =  p_contentid;
	END IF;

END $
DELIMITER ;