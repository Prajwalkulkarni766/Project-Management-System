delimiter $
CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_privileges`(
        INOUT `p_privilegeid` INT,
        IN `p_viewdashboard` INT,
        IN `p_movecontent` INT,
        IN `p_viewproject` INT,
        IN `p_addproject` INT,
        IN `p_editproject` INT,
        IN `p_viewreport` INT,
        IN `p_changeprivilege` INT,
        IN `p_createuser` INT,
        IN `p_viewedituser` INT,
        IN `p_chat` INT,
        IN `p_uploadimages` INT,
        IN `p_deleteimages` INT,
        IN `p_uploaddocuments` INT,
        IN `p_deletedocuments` INT,
        IN `p_userid` INT,
        IN `p_whoallowinguserid` INT,
        IN `p_mode` INT
)
BEGIN

-- mode 1 when user is admin
	IF(p_mode = 1) THEN
		-- insert the new record of the privilege
                INSERT INTO tbl_privileges (privilege_for_view_dashboard, privilege_for_move_dashboard_content,privilege_for_view_project,privilege_for_add_new_project,privilege_for_edit_project,privilege_for_view_reports,privilege_to_change_privilege,privilege_for_create_user,privilege_for_view_and_edit_created_user,privilege_for_chat,privilege_for_upload_images,privilege_for_delete_uploaded_images,privilege_for_upload_documents,privilege_for_delete_uploaded_documents,privilege_user_id,privilege_allowed_by) VALUES (1,1,1,1,1,1,1,1,1,1,1,1,1,1,p_userid,p_whoallowinguserid);
                SET p_privilegeid = LAST_INSERT_ID();

-- mode 2 when user is sub admin
	elseif (p_mode = 2) THEN
                -- insert the new record of the privilege
                INSERT INTO tbl_privileges (privilege_for_view_dashboard, privilege_for_move_dashboard_content,privilege_for_view_project,privilege_for_add_new_project,privilege_for_edit_project,privilege_for_view_reports,privilege_for_create_user,privilege_for_view_and_edit_created_user,privilege_for_chat,privilege_for_upload_images,privilege_for_delete_uploaded_images,privilege_for_upload_documents,privilege_for_delete_uploaded_documents,privilege_user_id,privilege_allowed_by) VALUES (1,1,1,1,1,1,1,1,1,1,1,1,1,p_userid,p_whoallowinguserid);
                SET p_privilegeid = LAST_INSERT_ID();

-- mode 3 when user is requirement gatherer
	elseif (p_mode = 3) THEN
                -- insert the new record of the privilege
                INSERT INTO tbl_privileges (privilege_for_view_dashboard, privilege_for_move_dashboard_content,privilege_for_view_project,privilege_for_add_new_project,privilege_for_edit_project,privilege_for_view_reports,privilege_for_create_user,privilege_for_view_and_edit_created_user,privilege_for_chat,privilege_for_upload_images,privilege_for_delete_uploaded_images,privilege_for_upload_documents,privilege_for_delete_uploaded_documents,privilege_user_id,privilege_allowed_by) VALUES (1,0,1,1,0,0,0,0,1,0,0,1,0,p_userid,p_whoallowinguserid);
                SET p_privilegeid = LAST_INSERT_ID();

-- mode 4 when user is developer
	elseif (p_mode = 4) THEN
        -- insert the new record of the privilege
                INSERT INTO tbl_privileges (privilege_for_view_dashboard, privilege_for_move_dashboard_content,privilege_for_view_project,privilege_for_add_new_project,privilege_for_edit_project,privilege_for_view_reports,privilege_for_create_user,privilege_for_view_and_edit_created_user,privilege_for_chat,privilege_for_upload_images,privilege_for_delete_uploaded_images,privilege_for_upload_documents,privilege_for_delete_uploaded_documents,privilege_user_id,privilege_allowed_by) VALUES (1,1,0,0,0,0,0,0,1,1,0,1,0,p_userid,p_whoallowinguserid);
                SET p_privilegeid = LAST_INSERT_ID();

-- mode 5 when user is tester
	elseif (p_mode = 5) THEN
                -- insert the new record of the privilege
                INSERT INTO tbl_privileges (privilege_for_view_dashboard, privilege_for_move_dashboard_content,privilege_for_view_project,privilege_for_add_new_project,privilege_for_edit_project,privilege_for_view_reports,privilege_for_create_user,privilege_for_view_and_edit_created_user,privilege_for_chat,privilege_for_upload_images,privilege_for_delete_uploaded_images,privilege_for_upload_documents,privilege_for_delete_uploaded_documents,privilege_user_id,privilege_allowed_by) VALUES (1,1,0,0,0,0,0,0,1,0,0,1,0,p_userid,p_whoallowinguserid);
                SET p_privilegeid = LAST_INSERT_ID();

-- mode 6 when user is custom while editing user
	elseif (p_mode = 6) THEN
                UPDATE tbl_user SET user_role = 6 WHERE user_id = p_userid;
                UPDATE tbl_privileges SET privilege_for_view_dashboard = p_viewdashboard, privilege_for_move_dashboard_content = p_movecontent, privilege_for_view_project = p_viewproject, privilege_for_add_new_project = p_addproject,
                privilege_for_edit_project = p_editproject,privilege_for_view_reports = p_viewreport,privilege_for_create_user = p_createuser,privilege_for_view_and_edit_created_user = p_viewedituser,privilege_for_chat = p_chat,privilege_for_upload_images = p_uploadimages,privilege_for_delete_uploaded_images = p_deleteimages,privilege_for_upload_documents = p_uploaddocuments,privilege_for_delete_uploaded_documents = p_deletedocuments,privilege_to_change_privilege = p_changeprivilege WHERE tbl_privileges.privilege_user_id = p_userid;
                SET p_privilegeid = (SELECT privilege_id FROM tbl_privileges WHERE privilege_user_id = p_userid);

        -- mode 7 when user is disabled
	elseif (p_mode = 7) THEN
                UPDATE tbl_privileges SET privilege_for_view_dashboard = 0, privilege_for_move_dashboard_content = 0, privilege_for_view_project = 0, privilege_for_add_new_project = 0,
                privilege_for_edit_project = 0,privilege_for_view_reports = 0,privilege_to_change_privilege = 0,privilege_for_create_user = 0,privilege_for_view_and_edit_created_user = 0,privilege_for_chat = 0,privilege_for_upload_images = 0,privilege_for_delete_uploaded_images = 0,privilege_for_upload_documents = 0,privilege_for_delete_uploaded_documents = 0, privilege_allowed_by=p_whoallowinguserid WHERE tbl_privileges.privilege_user_id = p_userid;
                SET p_privilegeid = (SELECT privilege_id FROM tbl_privileges WHERE privilege_user_id = p_userid);

-- mode 8 when user privelge right changed
	elseif (p_mode = 8) THEN
                CASE p_privilegeid

                -- when user become sub admin
                        WHEN 2 THEN
                                set p_viewdashboard = 1;set p_movecontent = 1;set p_viewproject = 1;set p_addproject = 1;set p_editproject = 1;set p_viewreport = 1;set p_createuser = 1;set p_viewedituser = 1;set p_chat = 1;set p_uploadimages = 1;set p_deleteimages = 1;set p_uploaddocuments = 1;set p_deletedocuments = 1;set  p_changeprivilege = 1;

                -- when user become requirement gatherer
                        WHEN 3 THEN
                                set p_viewdashboard = 1;set p_movecontent = 0;set p_viewproject = 1;set p_addproject = 1;set p_editproject = 0;set p_viewreport = 0;set p_createuser = 0;set p_viewedituser = 0;set p_chat = 1;set p_uploadimages = 0;set p_deleteimages = 0;set p_uploaddocuments = 1;set p_deletedocuments = 0;set  p_changeprivilege = 0;
                                -- 1,0,1,1,0,0,0,0,1,0,0,1,0,p_userid,p_whoallowinguserid,CURRENT_TIMESTAMP()

                -- when user become developer
                        WHEN 4 THEN
                                set p_viewdashboard = 1;set p_movecontent = 1;set p_viewproject = 0;set p_addproject = 0;set p_editproject = 0;set p_viewreport = 0;set p_createuser = 0;set p_viewedituser = 0;set p_chat = 1;set p_uploadimages = 1;set p_deleteimages = 0;set p_uploaddocuments = 1;             set p_deletedocuments = 0;set  p_changeprivilege = 0;
                                -- 1,1,0,0,0,0,0,0,1,1,0,1,0,p_userid,p_whoallowinguserid,CURRENT_TIMESTAMP()

                -- when user become tester
                        WHEN 5 THEN
                                set p_viewdashboard = 1;set p_movecontent = 1;set p_viewproject = 0;set p_addproject = 0;set p_editproject = 0;set p_viewreport = 0;set p_createuser = 0;set p_viewedituser = 0;set p_chat = 1;set p_uploadimages = 0;set p_deleteimages = 0;set p_uploaddocuments = 1;set p_deletedocuments = 0;set  p_changeprivilege = 0;
                                -- 1,1,0,0,0,0,0,0,1,0,0,1,0,p_userid,p_whoallowinguserid,CURRENT_TIMESTAMP()
END CASE;

                UPDATE tbl_privileges SET privilege_for_view_dashboard = p_viewdashboard, privilege_for_move_dashboard_content = p_movecontent, privilege_for_view_project = p_viewproject, privilege_for_add_new_project = p_addproject,
                privilege_for_edit_project = p_editproject,privilege_for_view_reports = p_viewreport,privilege_to_change_privilege =  p_changeprivilege,privilege_for_create_user = p_createuser,privilege_for_view_and_edit_created_user = p_viewedituser,privilege_for_chat = p_chat,privilege_for_upload_images = p_uploadimages,privilege_for_delete_uploaded_images = p_deleteimages,privilege_for_upload_documents = p_uploaddocuments,privilege_for_delete_uploaded_documents = p_deletedocuments WHERE tbl_privileges.privilege_user_id = p_userid;
                SET p_privilegeid = (SELECT privilege_id FROM tbl_privileges WHERE privilege_user_id = p_userid);
        END IF;

END $
delimiter ;