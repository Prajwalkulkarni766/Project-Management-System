CREATE DEFINER=`root`@`localhost` PROCEDURE `sp_gallery`(
	INOUT `p_imageid` VARCHAR(255),
	IN `p_userid` INT,
        IN `p_projectid` INT,
        IN `p_imageoriginalname` VARCHAR(200),
        IN `p_imagenewname` VARCHAR(200),
        IN `p_imagepath` VARCHAR(300),
        IN `p_mode` INT
)
BEGIN
        DECLARE v_imgpath VARCHAR(255) DEFAULT '';
-- mode 1 to insert the record of image
        IF(p_mode = 1) THEN
                -- insert the new record of the image
                INSERT INTO tbl_gallery (gallery_original_name, gallery_new_name, gallery_path, project_id, user_id) VALUES (p_imageoriginalname, p_imagenewname, p_imagepath, p_projectid, p_userid);

		-- update the count of images
                -- UPDATE tbl_count SET count_gallery = count_gallery + 1 WHERE project_id = p_projectid;
                SET p_imageid = LAST_INSERT_ID();
        END IF;

-- mode 2 to delete the image
        IF(p_mode = 2) THEN
                -- delete the record of image
                SET v_imgpath = (SELECT gallery_path FROM tbl_gallery WHERE gallery_id = p_imageid);
                DELETE FROM tbl_gallery WHERE gallery_id = p_imageid;

		-- update the count of images
                -- UPDATE tbl_count SET count_gallery = count_gallery - 1 WHERE project_id = p_projectid;
                SET p_imageid = v_imgpath;
        END IF;

END